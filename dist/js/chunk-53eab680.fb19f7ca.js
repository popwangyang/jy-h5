(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-53eab680"],{"3f72":function(t,e,a){},"7d57":function(t,e,a){"use strict";var n=a("3f72"),i=a.n(n);i.a},a07e:function(t,e,a){},af14:function(t,e,a){"use strict";var n=a("c0ef"),i=a.n(n);i.a},becf:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"merchantEditbox"},[a("div",{staticClass:"body"},[a("van-cell-group",[a("van-field",{attrs:{label:"商户名称","input-align":"right",placeholder:"请输入"},model:{value:t.data.name,callback:function(e){t.$set(t.data,"name",e)},expression:"data.name"}}),a("van-field",{attrs:{label:"账号","input-align":"right",placeholder:"请输入邮箱地址"},model:{value:t.data.account,callback:function(e){t.$set(t.data,"account",e)},expression:"data.account"}}),"create"==t.$route.query.type?a("van-field",{attrs:{label:"初始密码",type:t.inputType,"input-align":"right","right-icon":t.passwordIconType,placeholder:"请输入"},on:{"click-right-icon":t.righIconBtn},model:{value:t.data.password,callback:function(e){t.$set(t.data,"password",e)},expression:"data.password"}}):t._e(),a("div",{staticClass:"van-cell van-field"},[a("div",{staticClass:"van-cell__title van-field__label"},[t._v("是否启用")]),a("div",{staticClass:"van-cell__value"},[a("van-switch",{attrs:{"active-color":"#2BC8D6","inactive-color":"#ffffff",size:"22px"},model:{value:t.data.checked,callback:function(e){t.$set(t.data,"checked",e)},expression:"data.checked"}})],1)])],1),a("span",{staticClass:"box1"},[a("span",{staticClass:"title"},[t._v("关联场所")]),a("span",[a("span",{staticClass:"add",on:{click:t.btnPlace}},[a("span",{staticClass:"circle"},[a("van-icon",{attrs:{name:"plus",size:"0.2rem",color:"#FFFFFF"}})],1),a("span",[t._v("请选择")])])]),a("span",{staticClass:"body"},t._l(t.data.ktvList,function(e){return a("van-cell",{key:e.id},[a("template",{slot:"title"},[a("van-icon",{staticStyle:{"margin-right":"0.26rem","line-height":"100%"},attrs:{name:t.closeImg},on:{click:function(a){return t.deletBtn(e)}}}),a("span",{staticClass:"custom-text"},[t._v(t._s(e.name))])],1)],2)}),1)])],1),t.box2Flage?a("div",{staticClass:"box2"},[a("addPlace",{on:{ok:t.btnPlace},model:{value:t.data.ktvList,callback:function(e){t.$set(t.data,"ktvList",e)},expression:"data.ktvList"}})],1):t._e(),a("span",{staticClass:"footer"},["编辑商户"==t.title?a("span",{on:{click:function(e){return t.handleFrom("edite")}}},[t._v("保存账号")]):a("span",{on:{click:function(e){return t.handleFrom("create")}}},[t._v("创建账号")]),a("span",{on:{click:t.cancleBtn}},[t._v("取消")])])])},i=[],s=(a("7f7f"),a("b70e")),c=a("c276"),l=a("8492"),o=a("b970"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"searchPageBox"},[a("span",{staticClass:"nav"},[a("van-search",{attrs:{placeholder:"请输入门店名称","show-action":"",shape:"round",background:"#f4f4f4"},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}},[a("div",{staticClass:"navRight",attrs:{slot:"action"},slot:"action"})])],1),a("span",{staticClass:"body"},[""!=t.searchValue?a("van-list",{attrs:{finished:t.finished,"finished-text":t.finishedText},on:{load:t.getList},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,function(e){return a("van-cell",{key:e.id,attrs:{value:e.name},on:{click:function(a){return t.selectBtn(e)}}},[e.isSelected?a("van-icon",{attrs:{slot:"right-icon",name:"checked",color:"#01cca3"},slot:"right-icon"}):t._e()],1)}),1):t._e()],1),a("span",{staticClass:"footer"},[a("van-button",{staticClass:"button",attrs:{size:"large"},on:{click:t.onClickBtn}},[t._v("确定")])],1)])},u=[],d=a("71a5"),h={props:{value:{type:Array,default:function(){return[]}}},model:{prop:"value",event:"retunBack"},data:function(){return{selectArr:this.value,loading:!1,finished:!1,searchValue:"",list:[],page:1,page_size:30,total:"",finishedText:"没有更多了"}},methods:{onClickBtn:function(){this.$emit("ok")},selectBtn:function(t){t.isSelected?(t.isSelected=!1,this.selectArr.splice(this.selectArr.indexOf(t),1)):(t.isSelected=!0,this.selectArr.push(t)),this.$emit("retunBack",this.selectArr)},init:function(){this.list=[],this.total=0,this.page=1,this.page_size=30,this.loading=!1,this.finished=!1,this.finishedText="没有更多了！"},getList:function(){var t=this,e={name:this.searchValue,page:this.page,page_size:this.page_size};Object(d["n"])(e).then(function(e){e.data.results.map(function(t){return t.isSelected=!1});var a=t.list.concat(e.data.results),n={};t.list=a.reduce(function(t,e){return!n[e.id]&&(n[e.id]=t.push(e)),t},[]),console.log(t.value),Object(c["q"])(t.value,t.list),console.log(t.list),t.finishedText="没有更多了！",console.log(t.page,"[[[[[[[[[[[[[[]]]]]]]]]]]]]]"),t.page++,t.total=e.data.count,t.loading=!1,0==t.list.length&&(t.finishedText="暂无搜索内容！"),t.list.length>=t.total&&(t.finished=!0)})}},watch:{searchValue:{handler:function(t,e){""!=t&&this.init()},immediate:!1}},mounted:function(){document.title="门店选择"}},p=h,f=(a("7d57"),a("2877")),v=Object(f["a"])(p,r,u,!1,null,"2c4305f0",null),g=v.exports,m={components:{addPlace:g},data:function(){var t=function(t,e){""==t?e(new s["a"]("商户名称不能为空")):t.length>50?e(new s["a"]("商户名称不能超过50个字")):e()},e=function(t,e){var a=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,20}$/;""==t?e(new s["a"]("账号密码不能为空")):a.test(t)?e():e(new s["a"]("请输入6~20位数字和字母组合"))};return{inputTypeFlag:!0,box2Flage:!1,closeImg:a("0727"),data:{name:"",account:"",password:"",checked:!0,ktvList:[]},rule:{name:{required:!0,validator:t},account:{required:!0,type:"email",message:"账号不能为空"},password:{required:!0,validator:e},ktvList:{required:!0,type:"array",message:"请选择关联的ktv"}}}},computed:{title:function(){return"edite"==this.$route.query.type?(document.title="编辑商户","编辑商户"):(document.title="新建商户","新建商户")},passwordIconType:function(){return this.inputTypeFlag?"closed-eye":"eye-o"},inputType:function(){return this.inputTypeFlag?"password":"text"}},methods:{cancleBtn:function(){this.$router.go(-1)},deletBtn:function(t){this.data.ktvList.splice(this.data.ktvList.indexOf(t),1)},righIconBtn:function(){this.inputTypeFlag=!this.inputTypeFlag},btnPlace:function(){if(this.box2Flage=!this.box2Flage,!this.box2Flage)return"edite"==this.$route.params.type?(document.title="编辑商户","编辑商户"):(document.title="新建商户","新建商户");document.title="门店选择"},handleFrom:function(t){var e=this;if("edite"==this.$route.query.type&&delete this.rule.password,Object(c["c"])(this.data,this.rule)){this.loading=!0;var a={name:this.data.name,account:this.data.account,password:this.data.password,ktv:this.data.ktvList.reduce(function(t,e){return t.push(e.id+""),t},[]),status:this.data.checked};console.log(a),"edite"==t?(a.id=this.data.id,Object(l["b"])(a).then(function(t){e.loading=!1,o["c"].success("编辑成功"),setTimeout(function(){e.$router.go(-1)},500)}).catch(function(t){o["c"].fail(t.data.error[0]),e.loading=!1})):Object(l["a"])(a).then(function(t){e.loading=!1,Object(o["c"])("创建账号后系统会将\n账号和密码发送至该箱发送邮件"),setTimeout(function(){e.$router.go(-1)},500)}).catch(function(t){o["c"].fail(t.data.error[0]),e.loading=!1})}}},mounted:function(){"edite"==this.$route.query.type&&(this.data=JSON.parse(this.$route.query.data),console.log(this.data))}},b=m,k=(a("e561"),a("af14"),Object(f["a"])(b,n,i,!1,null,"3be53bb8",null));e["default"]=k.exports},c0ef:function(t,e,a){},e561:function(t,e,a){"use strict";var n=a("a07e"),i=a.n(n);i.a}}]);
//# sourceMappingURL=chunk-53eab680.fb19f7ca.js.map