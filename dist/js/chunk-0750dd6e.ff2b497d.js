(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0750dd6e"],{"112f":function(t,e,a){},"1ffd":function(t,e,a){},3724:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"van-cell",staticStyle:{"border-bottom":"1px solid #ebedf0",position:"relative"}},[t.required?a("span",{staticStyle:{color:"red",position:"absolute",left:"6px",top:"9px"}},[t._v("*")]):t._e(),a("div",{staticClass:"van-cell van-field",staticStyle:{padding:"0"},on:{click:t.clickBtn}},[a("div",{staticClass:"van-cell__title van-field__label"},[t._v(t._s(t.label))]),a("div",{staticClass:"van-cell__value",staticStyle:{display:"flex","align-items":"center","justify-content":"flex-end"}},[""==t.value?a("span",[t._v("\n\t\t\t\t\t\t\t"+t._s(t.placeholder)+"\n\t\t\t\t\t\t")]):a("span",{staticStyle:{color:"#000000"}},["map"==t.type?a("span",[t._v("\n\t\t\t\t\t\t\t  "+t._s(t._f("MapFilter")(t.value))+"\n\t\t\t\t\t\t\t")]):a("span",[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.value)+"\n\t\t\t\t\t\t\t")])]),a("van-icon",{staticStyle:{"margin-left":"4px"},attrs:{name:"arrow",size:"16px"}})],1)]),a("van-popup",{attrs:{position:"bottom"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},["default"==t.type?a("van-picker",{attrs:{"show-toolbar":"",columns:t.columns},on:{cancel:t.onCancel,confirm:t.onConfirm}}):t._e(),"map"==t.type?a("van-area",{attrs:{"area-list":t.areaList},on:{cancel:t.onCancel,confirm:t.onConfirm}}):t._e(),"date"==t.type?a("van-datetime-picker",{attrs:{type:"date","min-date":t.minDate,formatter:t.formatter},on:{cancel:t.onCancel,confirm:t.onConfirm},model:{value:t.currentDate,callback:function(e){t.currentDate=e},expression:"currentDate"}}):t._e(),"time"==t.type?a("van-datetime-picker",{attrs:{type:"time",disabled:t.disabled,"min-hour":t.minHour,"max-hour":t.maxHour,"min-minute":t.minMinute,"max-minute":t.maxMinute},on:{cancel:t.onCancel,confirm:t.onConfirm},model:{value:t.currentTime,callback:function(e){t.currentTime=e},expression:"currentTime"}}):t._e()],1)],1)},i=[],s=(a("c5f6"),a("1462")),r=a("90de"),o=a("c276"),c={props:{required:{type:Boolean,default:!1},type:{type:String,default:"default"},label:{type:String,default:"eee"},placeholder:{type:String,default:"请输入"},columns:{type:Array,default:function(){return[]}},minHour:{type:Number,default:0},maxHour:{type:Number,default:23},minMinute:{type:Number,default:0},maxMinute:{type:Number,default:59},disabled:{type:Boolean,default:!1},value:[String,Array]},model:{prop:"value",event:"returnBack"},filters:{MapFilter:function(t){return console.log(t),Object(r["c"])(t)}},computed:{mapValue:function(){return"map"==this.type?this.value[2].code:""}},data:function(){return{show:!1,areaList:s["default"],minDate:new Date(2e3,1,1),currentDate:new Date,currentTime:"12:00"}},methods:{formatter:function(t,e){return"year"===t?"".concat(e,"年"):"month"===t?"".concat(e,"月"):"day"===t?"".concat(e,"日"):e},clickBtn:function(){this.disabled||(this.show=!0)},onCancel:function(){this.defaultIndex=0,this.show=!1},onConfirm:function(t,e){var a="";switch(this.type){case"default":a=t;break;case"map":a=t;break;case"date":a=Object(o["e"])(t);break;case"time":a=t,this.$emit("change",t);break}this.$emit("returnBack",a),this.show=!1}},mounted:function(){}},l=c,u=(a("7bdd"),a("2877")),d=Object(u["a"])(l,n,i,!1,null,"e133b4d2",null);e["a"]=d.exports},"3b11":function(t,e,a){},"506d":function(t,e,a){"use strict";var n=a("1ffd"),i=a.n(n);i.a},"5a42":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"van-cell van-field"},[a("div",{staticClass:"van-cell__title van-field__label"},[t._v(t._s(t.label))]),a("div",{staticClass:"van-cell__value",staticStyle:{display:"flex","align-items":"center","justify-content":"flex-end","margin-left":"0.8rem"}},[a("span",{style:{color:t.color}},[t._v(" "+t._s(t.value)+" ")])])])},i=[],s={props:{label:{type:String,default:"企业注册名称"},value:{type:String,default:"杭州银乐迪西溪银泰店"},color:{type:String,default:"#999999"}},data:function(){return{}}},r=s,o=a("2877"),c=Object(o["a"])(r,n,i,!1,null,null,null);e["a"]=c.exports},"66c3":function(t,e,a){"use strict";var n=a("f3bb"),i=a.n(n);i.a},"70b8":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"addContractBox"},[1==t.pageState?a("span",[t.isSupplement?t._e():a("van-field",{attrs:{label:"合同编号",placeholder:"请输入","input-align":"right"},model:{value:t.data.number,callback:function(e){t.$set(t.data,"number",e)},expression:"data.number"}}),t.isSupplement?t._e():a("SelectComponent",{attrs:{label:"套餐名称",placeholder:"请选择",type:"default",columns:t._f("listFilter")(t.ktvRechargeList)},model:{value:t.recharge_packageName,callback:function(e){t.recharge_packageName=e},expression:"recharge_packageName"}}),a("van-field",{attrs:{label:"包厢数量",placeholder:"请输入","input-align":"right"},model:{value:t.data.box_count,callback:function(e){t.$set(t.data,"box_count",e)},expression:"data.box_count"}}),a("span",{staticClass:"line"}),t.isSupplement?t._e():a("SelectComponent",{attrs:{label:"合同起始日期",placeholder:"请选择",type:"date",columns:[]},model:{value:t.data.begin_date,callback:function(e){t.$set(t.data,"begin_date",e)},expression:"data.begin_date"}}),a("span",{staticClass:"line"}),a("Upload",{attrs:{maxCount:t.maxCount,title:"合同文件"},model:{value:t.data.annex,callback:function(e){t.$set(t.data,"annex",e)},expression:"data.annex"}}),t.isSupplement?a("span",{staticClass:"footer1"},[a("span",{on:{click:t.clickBtn}},[t._v("创建")]),a("span",{on:{click:t.cancelBtn}},[t._v("取消")])]):a("span",{staticClass:"footer"},[a("van-button",{staticClass:"button",attrs:{size:"large",loading:t.loading},on:{click:t.clickBtn}},[t._v("保存")])],1)],1):t._e(),0==t.pageState?a("span",{staticClass:"box"},[a("van-loading",{attrs:{type:"spinner",vertical:!0}},[t._v("加载中...")])],1):t._e()])},i=[],s=(a("7f7f"),a("c5f6"),a("fca0"),a("b70e")),r=a("c276"),o=a("9694"),c=a("b970"),l=a("71a5"),u=a("3724"),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"list3Box"},[a("span",{staticClass:"title"},[t._v("\n\t\t"+t._s(t.title)+"\n\t")]),a("span",{staticClass:"content"},[a("span",{staticClass:"item"},[""!=t.src&&"http"==t.src.substr(0,4)&&0==t.state?a("span",{staticClass:"box"},[a("van-image",{attrs:{width:"3.2rem",fit:"contain",src:t.src},on:{click:t.ImagePreviewBtn},scopedSlots:t._u([{key:"loading",fn:function(){return[a("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[t._v("加载失败")]},proxy:!0}],null,!1,3034482977)}),a("van-icon",{staticClass:"delete",attrs:{name:"delete",size:"0.6rem",color:"#fff"},on:{click:t.deleteBtn}})],1):t._e(),a("span",{staticStyle:{"align-self":"flex-end","margin-left":"10px","font-size":"14px"}},[t._v("\n\t\t\t\t"+t._s(t.fileName)+"\n\t\t\t")]),""==t.src||"http"!=t.src.substr(0,4)||0!=t.state?a("Upload",{ref:"upload",on:{upload:t.upload}}):t._e()],1)])])},p=[],f=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"uploadBox"},[a("van-uploader",{directives:[{name:"show",rawName:"v-show",value:1,expression:"1"}],attrs:{"after-read":t.afterRead,"max-count":30,multiple:""}}),a("span",{directives:[{name:"show",rawName:"v-show",value:1==t.state,expression:"state == 1"}],staticClass:"box1"},[a("van-image",{attrs:{width:"3.2rem",fit:"contain",src:t.src},on:{click:t.foo},scopedSlots:t._u([{key:"loading",fn:function(){return[a("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[t._v("加载失败")]},proxy:!0}])}),a("van-icon",{directives:[{name:"show",rawName:"v-show",value:1==t.closeState,expression:"closeState == 1"}],staticClass:"delete",attrs:{name:"delete",size:"0.6rem",color:"#fff"},on:{click:t.deleteBtn}}),a("van-circle",{directives:[{name:"show",rawName:"v-show",value:1==t.showCircle,expression:"showCircle == 1"}],staticClass:"circle",attrs:{rate:t.rate,speed:100,size:"60px","stroke-width":80},model:{value:t.currentRate,callback:function(e){t.currentRate=e},expression:"currentRate"}},[a("span",{staticClass:"van-circle__text",staticStyle:{color:"white","font-weight":"bold"}},[t._v("\n\t\t\t  "+t._s(t.text)+"\n\t\t  ")])])],1),a("span",{staticStyle:{"align-self":"flex-end","font-size":"14px","margin-left":"10px"}},[t._v("\n\t\t"+t._s(t.fileName)+"\n\t")])],1)},m=[],h=a("4ec3"),v={props:{id:{type:String,default:""}},data:function(){return{src:"",state:0,closeState:0,showCircle:0,currentRate:0,rate:0,fileList:[],fromData:{},fileName:""}},computed:{text:function(){return this.currentRate.toFixed(0)+"%"}},methods:{foo:function(){console.log("ppppp"),Object(c["b"])([this.src])},afterRead:function(t){var e=this;console.log(t),this.fileName=t.file.name,this.state=1,this.showCircle=1,this.closeState=0,this.src=t.content;var a={name:t.file.name,mime:t.file.type,size:1024*t.file.size},n=new Promise(function(n,i){Object(h["a"])("/copyright/upload/upload",a).then(function(a){e.fromData.token=a.credential,e.fromData.name=t.file.name,e.fromData.key=a.key,e.fromData.id=""===e.id?"":e.id,e.fromData.file=t.file,n(!0)}).catch(function(t){i(!1)})});n.then(function(){e.upload(e.fromData)})},upload:function(t){var e=this,a=new FormData;a.append("file",t.file),a.append("token",t.token),a.append("file",t.name),a.append("key",t.key),a.append("x:id",t.id);var n=new XMLHttpRequest;n.open("POST","https://up-z1.qiniup.com/",!0),n.onload=this.uploadCom,n.onerror=this.uploadFail,n.upload.onprogress=this.progressFunction,n.send(a),n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE)if(201===n.status){var t=JSON.parse(n.responseText);t.data;e.$emit("upload",t.id)}else try{var a=JSON.parse(n.responseText)["msg"];message.error(a,10)}catch(i){}}},progressFunction:function(t){this.state=1,this.rate=t.loaded/t.total*100,console.log(t)},uploadCom:function(t){var e=this;setTimeout(function(){e.closeState=1,e.showCircle=0},200)},uploadFail:function(){console.log("uploadFail")},deleteBtn:function(){this.fileName="",this.fileList=[],this.state=0,this.closeState=0,this.rate=0,this.fromData={},this.$emit("upload","")}},mounted:function(){}},b=v,g=(a("b094"),a("2877")),_=Object(g["a"])(b,f,m,!1,null,"2dd1814e",null),y=_.exports,x={components:{Upload:y},props:{title:{type:String,default:""},src:{type:String,default:""},name:{type:String,default:""},value:{type:String,default:""}},model:{prop:"value",event:"returnBack"},data:function(){return{state:0,fileName:this.name}},methods:{upload:function(t){console.log(t),this.$emit("returnBack",t+"")},ImagePreviewBtn:function(){Object(c["b"])([this.src])},deleteBtn:function(){console.log("d"),this.state=1,this.fileName="",this.$emit("returnBack","")}}},k=x,C=(a("66c3"),Object(g["a"])(k,d,p,!1,null,"35fa7c34",null)),w=(C.exports,a("5a42")),S={components:{SelectComponent:u["a"],Item1:w["a"],Upload:o["a"]},data:function(){var t=function(t,e){""==t?e(new s["a"]("合同编号不能为空")):t.length>50?e(new s["a"]("合同编号不能超过50个字")):e()},e=function(t,e){""==t?e(new s["a"]("包厢数不能为空")):!Number.isFinite(parseInt(t))&&parseInt(t)>0?e(new s["a"]("包厢数应为正整数")):e()};return{isSupplement:!1,maxCount:30,pageState:1,data:{number:"",annex:[],begin_date:"",ktv:this.$route.query.ktvID,recharge_package:"",box_count:""},id:"",recharge_packageName:"",loading:!1,ktvRechargeList:[],rule:{number:{required:!0,validator:t},annex:{required:!0,type:"array",message:"合同附件不能为空"},begin_date:{required:!0,message:"合同起始日期不能为空"},recharge_package:{required:!0,message:"套餐名称不能为空"},box_count:{required:!0,validator:e}}}},filters:{listFilter:function(t){return t.reduce(function(t,e){return t.push(e.name),t},[])}},watch:{recharge_packageName:{handler:function(t,e){var a=this;this.ktvRechargeList.map(function(e){e.name==t&&(a.data.recharge_package=e.id)})},immediate:!0}},methods:{cancelBtn:function(){this.$router.go(-1)},clickBtn:function(){var t=this;if(this.isSupplement&&(delete this.rule.number,delete this.rule.begin_date,delete this.rule.recharge_package),Object(r["c"])(this.data,this.rule)){console.log(this.data),c["c"].loading({duration:0,forbidClick:!0});var e=Object.assign({},this.data);if(e.annex=e.annex.reduce(function(t,e){return t.push(e.id),t},[]).join(","),e.box_count=Number(e.box_count),"create"==this.$route.query.type)Object(l["c"])(e).then(function(e){c["c"].clear(),c["c"].success("创建成功"),setTimeout(function(){t.$router.go(-1)},500)}).catch(function(t){c["c"].clear(),c["c"].fail(t.data.error[0])});else if("edite"==this.$route.query.type)e.id=this.id,Object(l["h"])(e).then(function(e){c["c"].clear(),c["c"].success("修改成功"),setTimeout(function(){t.$router.go(-1)},500)}).catch(function(t){c["c"].clear(),c["c"].fail(t.data.error[0])});else{var a={contract:this.$route.query.contractID,annex:e.annex,category:1,box_count:e.box_count};Object(l["z"])(a).then(function(e){c["c"].clear(),c["c"].success("补充成功"),setTimeout(function(){t.$router.go(-1)},500)}).catch(function(t){c["c"].clear(),c["c"].fail("补充失败")})}}},getList:function(){var t=this;this.pageState=0,Object(l["r"])().then(function(e){t.ktvRechargeList=e.data.results})},getContractDetail:function(){var t=this,e={ktv:this.$route.query.ktvID,state:1};Object(l["q"])(e).then(function(e){console.log(e),t.pageState=1;var a=e.data.results[0];t.id=a.id,t.data.annex="supplement"==t.$route.query.type?[]:a.annex,t.data.number=a.number,t.data.begin_date=a.begin_date,t.recharge_packageName=a.package_name,t.data.box_count=a.box_count})}},mounted:function(){this.getList(),document.title="新增合同","edite"==this.$route.query.type?(document.title="修改合同",this.getContractDetail()):"supplement"==this.$route.query.type&&(this.maxCount=1,this.isSupplement=!0,document.title="补充合同",this.getContractDetail())}},N=S,$=(a("506d"),Object(g["a"])(N,n,i,!1,null,"86b006de",null));e["default"]=$.exports},"7bdd":function(t,e,a){"use strict";var n=a("112f"),i=a.n(n);i.a},b094:function(t,e,a){"use strict";var n=a("3b11"),i=a.n(n);i.a},f3bb:function(t,e,a){},fca0:function(t,e,a){var n=a("5ca1"),i=a("7726").isFinite;n(n.S,"Number",{isFinite:function(t){return"number"==typeof t&&i(t)}})}}]);
//# sourceMappingURL=chunk-0750dd6e.ff2b497d.js.map