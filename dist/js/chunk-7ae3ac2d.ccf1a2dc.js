(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7ae3ac2d"],{"112f":function(e,t,a){},3724:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"van-cell",staticStyle:{"border-bottom":"1px solid #ebedf0",position:"relative"}},[e.required?a("span",{staticStyle:{color:"red",position:"absolute",left:"6px",top:"9px"}},[e._v("*")]):e._e(),a("div",{staticClass:"van-cell van-field",staticStyle:{padding:"0"},on:{click:e.clickBtn}},[a("div",{staticClass:"van-cell__title van-field__label"},[e._v(e._s(e.label))]),a("div",{staticClass:"van-cell__value",staticStyle:{display:"flex","align-items":"center","justify-content":"flex-end"}},[""==e.value?a("span",[e._v("\n\t\t\t\t\t\t\t"+e._s(e.placeholder)+"\n\t\t\t\t\t\t")]):a("span",{staticStyle:{color:"#000000"}},["map"==e.type?a("span",[e._v("\n\t\t\t\t\t\t\t  "+e._s(e._f("MapFilter")(e.value))+"\n\t\t\t\t\t\t\t")]):a("span",[e._v("\n\t\t\t\t\t\t\t\t"+e._s(e.value)+"\n\t\t\t\t\t\t\t")])]),a("van-icon",{staticStyle:{"margin-left":"4px"},attrs:{name:"arrow",size:"16px"}})],1)]),a("van-popup",{attrs:{position:"bottom"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},["default"==e.type?a("van-picker",{attrs:{"show-toolbar":"",columns:e.columns},on:{cancel:e.onCancel,confirm:e.onConfirm}}):e._e(),"map"==e.type?a("van-area",{attrs:{"area-list":e.areaList},on:{cancel:e.onCancel,confirm:e.onConfirm}}):e._e(),"date"==e.type?a("van-datetime-picker",{attrs:{type:"date","min-date":e.minDate,formatter:e.formatter},on:{cancel:e.onCancel,confirm:e.onConfirm},model:{value:e.currentDate,callback:function(t){e.currentDate=t},expression:"currentDate"}}):e._e(),"time"==e.type?a("van-datetime-picker",{attrs:{type:"time",disabled:e.disabled,"min-hour":e.minHour,"max-hour":e.maxHour,"min-minute":e.minMinute,"max-minute":e.maxMinute},on:{cancel:e.onCancel,confirm:e.onConfirm},model:{value:e.currentTime,callback:function(t){e.currentTime=t},expression:"currentTime"}}):e._e()],1)],1)},i=[],r=(a("c5f6"),a("1462")),s=a("90de"),o=a("c276"),c={props:{required:{type:Boolean,default:!1},type:{type:String,default:"default"},label:{type:String,default:"eee"},placeholder:{type:String,default:"请输入"},columns:{type:Array,default:function(){return[]}},minHour:{type:Number,default:0},maxHour:{type:Number,default:23},minMinute:{type:Number,default:0},maxMinute:{type:Number,default:59},disabled:{type:Boolean,default:!1},value:[String,Array]},model:{prop:"value",event:"returnBack"},filters:{MapFilter:function(e){return console.log(e),Object(s["c"])(e)}},computed:{mapValue:function(){return"map"==this.type?this.value[2].code:""}},data:function(){return{show:!1,areaList:r["default"],minDate:new Date(2e3,1,1),currentDate:new Date,currentTime:"12:00"}},methods:{formatter:function(e,t){return"year"===e?"".concat(t,"年"):"month"===e?"".concat(t,"月"):"day"===e?"".concat(t,"日"):t},clickBtn:function(){this.disabled||(this.show=!0)},onCancel:function(){this.defaultIndex=0,this.show=!1},onConfirm:function(e,t){var a="";switch(this.type){case"default":a=e;break;case"map":a=e;break;case"date":a=Object(o["h"])(e);break;case"time":a=e,this.$emit("change",e);break}this.$emit("returnBack",a),this.show=!1}},mounted:function(){}},l=c,u=(a("7bdd"),a("2877")),d=Object(u["a"])(l,n,i,!1,null,"e133b4d2",null);t["a"]=d.exports},"3b11":function(e,t,a){},"5a42":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"van-cell van-field"},[a("div",{staticClass:"van-cell__title van-field__label"},[e._v(e._s(e.label))]),a("div",{staticClass:"van-cell__value",staticStyle:{display:"flex","align-items":"center","justify-content":"flex-end","margin-left":"0.8rem"}},[a("span",{style:{color:e.color}},[e._v(" "+e._s(e.value)+" ")])])])},i=[],r={props:{label:{type:String,default:"企业注册名称"},value:{type:String,default:"杭州银乐迪西溪银泰店"},color:{type:String,default:"#999999"}},data:function(){return{}}},s=r,o=a("2877"),c=Object(o["a"])(s,n,i,!1,null,null,null);t["a"]=c.exports},"66c3":function(e,t,a){"use strict";var n=a("f3bb"),i=a.n(n);i.a},"70b8":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"addContractBox"},[1==e.pageState?a("span",[e.isSupplement?e._e():a("van-field",{attrs:{label:"合同编号",placeholder:"请输入","input-align":"right"},model:{value:e.data.number,callback:function(t){e.$set(e.data,"number",t)},expression:"data.number"}}),e.isSupplement?e._e():a("SelectComponent",{attrs:{label:"套餐名称",placeholder:"请选择",type:"default",columns:e._f("listFilter")(e.ktvRechargeList)},model:{value:e.recharge_packageName,callback:function(t){e.recharge_packageName=t},expression:"recharge_packageName"}}),a("van-field",{attrs:{label:"包厢数量",placeholder:"请输入","input-align":"right"},model:{value:e.data.box_count,callback:function(t){e.$set(e.data,"box_count",t)},expression:"data.box_count"}}),a("span",{staticClass:"line"}),e.isSupplement?e._e():a("SelectComponent",{attrs:{label:"合同起始日期",placeholder:"请选择",type:"date",columns:[]},model:{value:e.data.begin_date,callback:function(t){e.$set(e.data,"begin_date",t)},expression:"data.begin_date"}}),e.isShowChargeable_time?a("SelectComponent",{attrs:{label:"结算起始日期",placeholder:"请选择",type:"default",columns:e.dateColumns},model:{value:e.data.chargeableTime,callback:function(t){e.$set(e.data,"chargeableTime",t)},expression:"data.chargeableTime"}}):e._e(),a("span",{staticClass:"line"}),e._v("', 'jpeg']'\n\t\t:maxSize=\"100\" \n\t\t/>\n\t\t"),e.isSupplement?a("span",{staticClass:"footer1"},[a("span",{on:{click:e.clickBtn}},[e._v("创建")]),a("span",{on:{click:e.cancelBtn}},[e._v("取消")])]):a("span",{staticClass:"footer"},[a("van-button",{staticClass:"button",attrs:{size:"large",loading:e.loading},on:{click:e.clickBtn}},[e._v("保存")])],1)],1):e._e(),0==e.pageState?a("span",{staticClass:"box"},[a("van-loading",{attrs:{type:"spinner",vertical:!0}},[e._v("加载中...")])],1):e._e()])},i=[],r=(a("96cf"),a("3b8d")),s=(a("7f7f"),a("c5f6"),a("fca0"),a("b70e")),o=a("c276"),c=a("9694"),l=a("b970"),u=a("71a5"),d=a("3724"),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"list3Box"},[a("span",{staticClass:"title"},[e._v("\n\t\t"+e._s(e.title)+"\n\t")]),a("span",{staticClass:"content"},[a("span",{staticClass:"item"},[""!=e.src&&"http"==e.src.substr(0,4)&&0==e.state?a("span",{staticClass:"box"},[a("van-image",{attrs:{width:"3.2rem",fit:"contain",src:e.src},on:{click:e.ImagePreviewBtn},scopedSlots:e._u([{key:"loading",fn:function(){return[a("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[e._v("加载失败")]},proxy:!0}],null,!1,3034482977)}),a("van-icon",{staticClass:"delete",attrs:{name:"delete",size:"0.6rem",color:"#fff"},on:{click:e.deleteBtn}})],1):e._e(),a("span",{staticStyle:{"align-self":"flex-end","margin-left":"10px","font-size":"14px"}},[e._v("\n\t\t\t\t"+e._s(e.fileName)+"\n\t\t\t")]),""==e.src||"http"!=e.src.substr(0,4)||0!=e.state?a("Upload",{ref:"upload",on:{upload:e.upload}}):e._e()],1)])])},m=[],f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"uploadBox"},[a("van-uploader",{directives:[{name:"show",rawName:"v-show",value:1,expression:"1"}],attrs:{"after-read":e.afterRead,"max-count":30,multiple:""}}),a("span",{directives:[{name:"show",rawName:"v-show",value:1==e.state,expression:"state == 1"}],staticClass:"box1"},[a("van-image",{attrs:{width:"3.2rem",fit:"contain",src:e.src},on:{click:e.foo},scopedSlots:e._u([{key:"loading",fn:function(){return[a("van-loading",{attrs:{type:"spinner",size:"20"}})]},proxy:!0},{key:"error",fn:function(){return[e._v("加载失败")]},proxy:!0}])}),a("van-icon",{directives:[{name:"show",rawName:"v-show",value:1==e.closeState,expression:"closeState == 1"}],staticClass:"delete",attrs:{name:"delete",size:"0.6rem",color:"#fff"},on:{click:e.deleteBtn}}),a("van-circle",{directives:[{name:"show",rawName:"v-show",value:1==e.showCircle,expression:"showCircle == 1"}],staticClass:"circle",attrs:{rate:e.rate,speed:100,size:"60px","stroke-width":80},model:{value:e.currentRate,callback:function(t){e.currentRate=t},expression:"currentRate"}},[a("span",{staticClass:"van-circle__text",staticStyle:{color:"white","font-weight":"bold"}},[e._v("\n\t\t\t  "+e._s(e.text)+"\n\t\t  ")])])],1),a("span",{staticStyle:{"align-self":"flex-end","font-size":"14px","margin-left":"10px"}},[e._v("\n\t\t"+e._s(e.fileName)+"\n\t")])],1)},h=[],v=a("4ec3"),b={props:{id:{type:String,default:""}},data:function(){return{src:"",state:0,closeState:0,showCircle:0,currentRate:0,rate:0,fileList:[],fromData:{},fileName:""}},computed:{text:function(){return this.currentRate.toFixed(0)+"%"}},methods:{foo:function(){console.log("ppppp"),Object(l["b"])([this.src])},afterRead:function(e){var t=this;console.log(e),this.fileName=e.file.name,this.state=1,this.showCircle=1,this.closeState=0,this.src=e.content;var a={name:e.file.name,mime:e.file.type,size:1024*e.file.size},n=new Promise(function(n,i){Object(v["a"])("/copyright/upload/upload",a).then(function(a){t.fromData.token=a.credential,t.fromData.name=e.file.name,t.fromData.key=a.key,t.fromData.id=""===t.id?"":t.id,t.fromData.file=e.file,n(!0)}).catch(function(e){i(!1)})});n.then(function(){t.upload(t.fromData)})},upload:function(e){var t=this,a=new FormData;a.append("file",e.file),a.append("token",e.token),a.append("file",e.name),a.append("key",e.key),a.append("x:id",e.id);var n=new XMLHttpRequest;n.open("POST","https://up-z1.qiniup.com/",!0),n.onload=this.uploadCom,n.onerror=this.uploadFail,n.upload.onprogress=this.progressFunction,n.send(a),n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE)if(201===n.status){var e=JSON.parse(n.responseText);e.data;t.$emit("upload",e.id)}else try{var a=JSON.parse(n.responseText)["msg"];message.error(a,10)}catch(i){}}},progressFunction:function(e){this.state=1,this.rate=e.loaded/e.total*100,console.log(e)},uploadCom:function(e){var t=this;setTimeout(function(){t.closeState=1,t.showCircle=0},200)},uploadFail:function(){console.log("uploadFail")},deleteBtn:function(){this.fileName="",this.fileList=[],this.state=0,this.closeState=0,this.rate=0,this.fromData={},this.$emit("upload","")}},mounted:function(){}},g=b,_=(a("b094"),a("2877")),y=Object(_["a"])(g,f,h,!1,null,"2dd1814e",null),x=y.exports,k={components:{Upload:x},props:{title:{type:String,default:""},src:{type:String,default:""},name:{type:String,default:""},value:{type:String,default:""}},model:{prop:"value",event:"returnBack"},data:function(){return{state:0,fileName:this.name}},methods:{upload:function(e){console.log(e),this.$emit("returnBack",e+"")},ImagePreviewBtn:function(){Object(l["b"])([this.src])},deleteBtn:function(){console.log("d"),this.state=1,this.fileName="",this.$emit("returnBack","")}}},C=k,w=(a("66c3"),Object(_["a"])(C,p,m,!1,null,"35fa7c34",null)),S=(w.exports,a("5a42")),$={components:{SelectComponent:d["a"],Item1:S["a"],Upload:c["a"]},data:function(){var e=function(e,t){""==e?t(new s["a"]("合同编号不能为空")):e.length>50?t(new s["a"]("合同编号不能超过50个字")):t()},t=function(e,t){""==e?t(new s["a"]("包厢数不能为空")):!Number.isFinite(parseInt(e))&&parseInt(e)>0?t(new s["a"]("包厢数应为正整数")):t()};return{dateColumns:Object(o["s"])(30),isSupplement:!1,maxCount:30,pageState:1,data:{number:"",annex:[],begin_date:"",ktv:this.$route.query.ktvID,recharge_package:"",box_count:"",chargeableTime:Object(o["f"])(this.$store.state.ktv.ktvData.chargeable_time)+"天后"},id:"",recharge_packageName:"",loading:!1,ktvRechargeList:[],rule:{number:{required:!0,validator:e},annex:{required:!0,type:"array",message:"合同附件不能为空"},begin_date:{required:!0,message:"合同起始日期不能为空"},chargeableTime:{required:!0,message:"结算起始日期不能为空"},recharge_package:{required:!0,message:"套餐名称不能为空"},box_count:{required:!0,validator:t}}}},computed:{isShowChargeable_time:function(){return!this.isSupplement&&2==this.$store.state.ktv.ktvData.account_status}},filters:{listFilter:function(e){return e.reduce(function(e,t){return e.push(t.name),e},[])}},watch:{recharge_packageName:{handler:function(e,t){var a=this;this.ktvRechargeList.map(function(t){t.name==e&&(a.data.recharge_package=t.id)})},immediate:!0}},methods:{cancelBtn:function(){this.$router.go(-1)},clickBtn:function(){var e=this;if(this.isSupplement&&(delete this.rule.number,delete this.rule.begin_date,delete this.rule.recharge_package),this.isShowChargeable_time||delete this.rule.chargeableTime,Object(o["c"])(this.data,this.rule)){l["d"].loading({duration:0,forbidClick:!0});var t=Object.assign({},this.data);if(t.annex=t.annex.reduce(function(e,t){return e.push(t.id),e},[]).join(","),t.box_count=Number(t.box_count),t.chargeable_time=Object(o["n"])(parseInt(this.data.chargeableTime.substr(0,this.data.chargeableTime.length-2))),delete t.chargeableTime,console.log(t,"？？？？？？？？？"),"create"==this.$route.query.type)Object(u["c"])(t).then(function(a){l["d"].clear(),l["d"].success("创建成功"),setTimeout(function(){e.$router.go(-1)},500),e.isShowChargeable_time&&e.$store.commit("editKtvData",{key:"chargeable_time",value:t.chargeable_time})}).catch(function(e){l["d"].clear(),l["d"].fail(e.data.errors[0].message)});else if("edite"==this.$route.query.type)t.id=this.id,Object(u["h"])(t).then(function(a){l["d"].clear(),l["d"].success("修改成功"),e.isShowChargeable_time&&e.$store.commit("editKtvData",{key:"chargeable_time",value:t.chargeable_time}),console.log(e.$store.state.ktv.ktvData),setTimeout(function(){e.$router.go(-1)},500)}).catch(function(e){l["d"].clear(),l["d"].fail(e.data.errors[0].message)});else{var a={contract:this.$route.query.contractID,annex:t.annex,category:1,box_count:t.box_count};Object(u["z"])(a).then(function(t){l["d"].clear(),l["d"].success("补充成功"),setTimeout(function(){e.$router.go(-1)},500)}).catch(function(e){l["d"].clear(),l["d"].fail(e.data.errors[0].message)})}}},getList:function(){var e=this;return new Promise(function(t,a){Object(u["r"])().then(function(a){e.ktvRechargeList=a.data.results,t(!0)}).catch(function(e){a(!1)})})},getContractDetail:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t={number:this.$route.query.number,ktv:this.$route.query.ktvID,state:1},e.next=3,this.getList();case 3:this.pageState=0,Object(u["q"])(t).then(function(e){console.log(e),a.pageState=1;var t=e.data.results[e.data.count-1];a.id=t.id,a.data.annex="supplement"==a.$route.query.type?[]:t.annex,a.data.number=t.number,a.data.begin_date=t.begin_date,a.recharge_packageName=t.package_name,a.data.box_count=t.box_count});case 5:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},mounted:function(){"edite"==this.$route.query.type?(document.title="修改合同",this.getContractDetail()):"supplement"==this.$route.query.type?(this.maxCount=1,this.isSupplement=!0,document.title="补充合同",this.getContractDetail()):(document.title="新增合同",this.getList())}},D=$,N=(a("9080"),Object(_["a"])(D,n,i,!1,null,"a6d9d77c",null));t["default"]=N.exports},"7bdd":function(e,t,a){"use strict";var n=a("112f"),i=a.n(n);i.a},9080:function(e,t,a){"use strict";var n=a("fe30"),i=a.n(n);i.a},b094:function(e,t,a){"use strict";var n=a("3b11"),i=a.n(n);i.a},f3bb:function(e,t,a){},fca0:function(e,t,a){var n=a("5ca1"),i=a("7726").isFinite;n(n.S,"Number",{isFinite:function(e){return"number"==typeof e&&i(e)}})},fe30:function(e,t,a){}}]);
//# sourceMappingURL=chunk-7ae3ac2d.ccf1a2dc.js.map